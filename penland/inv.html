<!DOCTYPE html>
<html>
  <head>
    <title>Penland Inventory test</title>
    <meta charset="UTF-8">
    <style>
body {
  font-family: monospace;
  background: black;
  color: white;
}
p {
  position: fixed;
  z-index: 100;
}
#stage, #cover, #player, #cursor, #inv {
  height: 360px;
  width: 480px;
  position: fixed;
  margin: auto;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
}
#stage {
  background: #CEECFF;
}
.block {
  position: absolute;
  height: 16px;
}
#cover {
  box-shadow: 0 0 0 99999px black;
  cursor: none;
}
#player {
  background: #673AB7;
  height: 32px;
  width: 16px;
}
#cursor {
  height: 16px;
  width: 16px;
}
#inv ul {
  margin: 0;
  padding: 0;
}
#inv .invSlot {
  background: rgba(0,0,0,0.1);
  display: block;
  height: 40px;
  width: 40px;
  border-radius: 20px;
  float: left;
  margin: 2.5px;
}
#inv .invSlot, .hand, .handd {
  -webkit-text-fill-color: white;
  -webkit-text-stroke-width: 0.5px;
  -webkit-text-stroke-color: black;
  text-align: center;
  font-size: 13px;
  background-size: 40px;
  background-repeat: no-repeat;
  background-position: center;
}
#inv .invname:first-child {
  -webkit-text-fill-color: white;
  -webkit-text-stroke-width: 1px;
  -webkit-text-stroke-color: black;
}
#inv #availables p {
  margin: 0;
  position: static;
}
#inv .invSlot:hover {
  background: rgba(0,0,0,0.3);
}
#inv .block {
  width: 16px;
  top: 4px;
  transform: scale(1.5);
  left: 12px;
  position: relative;
}
#inv #info, #inv #availables {
  background: rgba(0,0,0,0.1);
  right: 0;
  height: 290px;
  width: 220px;
  margin: 10px;
  border-radius: 5px;
  position: absolute;
}
#inv #info #tabs {
  display:-webkit-flex;
  -webkit-justify-content:center;
  display:flex;
  justify-content:center;
}
#inv #info:hover, #inv #availables:hover {
  background: rgba(0,0,0,0.3);
}
#inv #info #tabs li {
  display: inline-block;
  background: rgba(255,255,255,0.2);
  height: 40px;
  -webkit-flex:1;
  flex: 1;
  background-size: 40px;
  background-repeat: no-repeat;
  background-position: center;
}
#inv #info #tabs li:hover, #inv #info #tabs .active {
  background: rgba(255,255,255,0.5);
  background-size: 40px;
  background-repeat: no-repeat;
  background-position: center;
}
#inv #info #tabs #inf {background-image: url(materialicon_info_outline.svg);border-top-left-radius: 5px;}
#inv #info #tabs #craft {background-image: url(materialicon_build.svg);}
#inv #info #tabs #clothes {background-image: url(shirt.svg);}
#inv #info #tabs #menu {background-image: url(materialicon_view_list.svg);border-top-right-radius: 5px;}
#inv #info #content, #inv #availables li {
  background: rgba(0,0,0,0.1);
  background-size: 100%;
  background-repeat: no-repeat;
  background-position: center;
}
#inv #info #content h1, #inv #availables h1 {margin: 0;}
#inv #info #content img {width: 100%;}
.hand, .handd {
  background-color: rgba(0,0,0,0.1);
  bottom: 0;
  height: 40px;
  width: 40px;
  margin: 10px;
  border-radius: 5px;
  position: absolute;
}
.hand {
  width: 105px;
}
#inv #availables li {display:block;}
#inv #availables li:first-child {
  border-top-left-radius: 5px;
  border-top-right-radius: 5px;
}
#inv #availables li:last-child {
  border-bottom-left-radius: 5px;
  border-bottom-right-radius: 5px;
}
/*#inv .hand:hover {background-color: rgba(0,0,0,0.3);}*/
#uno {right: 45px;}
#one {right: 115px;}
#two {right: 0;}
.grass {background: #866247;background-image: url(grass.svg);}
.dirt {background: #866247;}
.stone {background: #919596;}
.reinforceddiamond {background: #212121;}
.tallgrass {background-image: url(tallgrass.svg);}
.oaktrunk {background: #74674F;}
.oaktreaves {background: #719C34;}
.oakleaves {background: #82B53C;}
.pinetrunk {background: #4E342E;}
.pinetreaves {background: #304D07;}
.pineleaves {background: #406609;}
.auttrunk {background: #9E715C;}
.aut1treaves {background: #C0412A;}
.aut1leaves {background: #D84830;}
.aut2treaves {background: #D78241;}
.aut2leaves {background: #F09048;}
.aut3treaves {background: #D7AC56;}
.aut3leaves {background: #F0C060;}
.sand {background: #EED38B;}
.water {background: #2DAEF3;}
.gravel {background: #B8BCBD;}
.rose {background-image: url(rose.svg);}
.goldenrod {background-image: url(goldenrod.svg);}
.myosotis {background-image: url(myosotis.svg);}
.feore {background: #BA603B;background-image: url(ore.svg);}
.auore {background: #D2A70B;background-image: url(ore.svg);}
.cuore {background: #558674;background-image: url(ore.svg);}
.poore {background: #AC584B;background-image: url(ore.svg);}
.coal {background: #222;background-image: url(ore.svg);}
.assembler {background-image: url(items/assembler.svg);}
.grasspile {background: #1B8505;}
.grassblock {background: #166C04;}
.toughgrass {background: #105203;}
.melter {background-image: url(items/melter.svg);}
.lava {background: #FF6015;}
.acid {background: #00FF00;}
.heal {background: #F06292;}
.oaksapling {background-image: url(items/oaksap.svg);}
.pinesapling {background-image: url(items/pinesap.svg);}
.autumnsapling {background-image: url(items/autsap.svg);}
.vapour {background: white;}
.acidproof {background: #799779;}
.acidvapour {background: #CDFFCD;}
    </style>
  </head>
  <body>
    <p>WASD to move. Q is left hand, E is right hand. Mouse to select blocks. 3 opens inventory and closes menus. 2 to interact with makers.<a href="#lolnotyet">Next</a></p>
    <div id="stage"></div>
    <img id="cursor" src="cursor.svg"/>
    <div id="player"></div>
    <div id="cover"></div>
    <div id="inv"><div class='handd' id='uno'></div><div class='handd' id='two'></div></div>

    <script src="../../sheep.js"></script>
    <script>
var level,loop,
mX=0,mY=0, // cursor pos
lW=300,lH=200, // level size
sX=lW*8-240,sY=lH*8-240, // scroll
pausd=true,mineInfo=[],
wD=false,aD=false,dD=false,sD=false,spD=false,qD=false,eD=false,twoD=false,
xv=0,yv=0,x=sX,y=sY,
blockData={
  /* trnsp:transparent, mineTime:time it takes to mine in seconds w/o tools, liquid, grainy:affected by gravity, drops:items added to inventory when mined, furn:has a menu,
  tool:correct tool 1-drill 2-bucket 3-saw 4-scissors 5-shovel, acidproof:undestroyable by acid */
  air:{trnsp:1,groundCover:1,mineTime:-1,drops:{},acidproof:1},
  grass:{mineTime:0.5,grainy:1,drops:{dirt:1,grass:1},tool:5},
  dirt:{mineTime:0.5,grainy:1,drops:{dirt:1},tool:5},
  stone:{mineTime:3,drops:{rock:4},tool:1},
  reinforceddiamond:{mineTime:-1,drops:{},acidproof:1},
  tallgrass:{trnsp:1,mineTime:0.1,groundCover:1,drops:{grass:"1-2"},tool:4},
  oaktrunk:{grainy:1,mineTime:1,drops:{wood:"1-4"},tool:3},
  oaktreaves:{grainy:"treaves",mineTime:0.5,drops:{leaf:"2-5",stick:"1-4",oaksapling:"0-1"},tool:4},
  oakleaves:{grainy:"leaves",mineTime:0.5,drops:{leaf:"2-5",stick:"1-4",oaksapling:"0-1"},trnsp:1,tool:4},
  pinetrunk:{grainy:1,mineTime:1,drops:{wood:"1-4"},tool:3},
  pinetreaves:{grainy:"treaves",mineTime:0.5,drops:{pineneedle:"2-5",stick:"1-4",pinesapling:"0-1"},tool:4},
  pineleaves:{grainy:"leaves",mineTime:0.5,drops:{pineneedle:"2-5",stick:"1-4",pinesapling:"0-1"},trnsp:1,tool:4},
  auttrunk:{grainy:1,mineTime:1,drops:{wood:"1-4"},tool:3},
  aut1treaves:{grainy:"treaves",mineTime:0.5,drops:{leaf:"2-5",stick:"1-4",autumnsapling:"0-1"},tool:4},
  aut1leaves:{grainy:"leaves",mineTime:0.5,drops:{leaf:"2-5",stick:"1-4",autumnsapling:"0-1"},trnsp:1,tool:4},
  aut2treaves:{grainy:"treaves",mineTime:0.5,drops:{leaf:"2-5",stick:"1-4",autumnsapling:"0-1"},tool:4},
  aut2leaves:{grainy:"leaves",mineTime:0.5,drops:{leaf:"2-5",stick:"1-4",autumnsapling:"0-1"},trnsp:1,tool:4},
  aut3treaves:{grainy:"treaves",mineTime:0.5,drops:{leaf:"2-5",stick:"1-4",autumnsapling:"0-1"},tool:4},
  aut3leaves:{grainy:"leaves",mineTime:0.5,drops:{leaf:"2-5",stick:"1-4",autumnsapling:"0-1"},trnsp:1,tool:4},
  sand:{mineTime:0.5,grainy:1,drops:{sand:1},tool:2},
  water:{mineTime:5,liquid:1,drops:{water:1},tool:2},
  gravel:{mineTime:0.5,grainy:1,drops:{rock:1},tool:5},
  rose:{trnsp:1,mineTime:0.1,groundCover:1,drops:{rose:1},tool:4},
  goldenrod:{trnsp:1,mineTime:0.1,groundCover:1,drops:{goldenrod:1},tool:4},
  myosotis:{trnsp:1,mineTime:0.1,groundCover:1,drops:{myosotis:1},tool:4},
  feore:{mineTime:3,drops:{rock:4,iron:"1-3"},tool:1},
  auore:{mineTime:3,drops:{rock:4,gold:"1-3"},tool:1},
  cuore:{mineTime:3,drops:{rock:4,copper:"1-3"},tool:1},
  poore:{mineTime:3,drops:{rock:4,powerpowder:"1-3"},tool:1},
  coal:{mineTime:3,drops:{rock:4,coal:"1-3"},tool:1},
  assembler:{mineTime:1,drops:{assembler:1},trnsp:1,furn:1,tool:3},
  melter:{mineTime:1,drops:{melter:1},trnsp:1,furn:1,tool:1},
  grasspile:{mineTime:0.5,grainy:1,drops:{grasspile:1},tool:4},
  grassblock:{mineTime:1,drops:{grassblock:1},tool:5},
  toughgrass:{mineTime:3,drops:{toughergrassblock:1},tool:1},
  lava:{mineTime:5,liquid:1,drops:{lava:1},tool:2},
  acid:{mineTime:-1,liquid:1,drops:{},acidproof:1},
  heal:{mineTime:5,liquid:1,drops:{healingliquid:1},tool:2},
  oaksapling:{trnsp:1,mineTime:0.1,groundCover:1,drops:{oaksapling:1},tool:4},
  vapour:{mineTime:5,drops:{},trnsp:1},
  acidproof:{mineTime:5,drops:{},tool:1,acidproof:1},
  acidvapour:{mineTime:5,drops:{},acidproof:1,trnsp:1},
},itemData={ /* texture=url of svg texture, ingrid=assembling recipe, desc=description in inventory, place=name of block to place, metals=melting recipe,
  tool:1-drill 2-bucket 3-saw 4-scissors 5-shovel, toolspeed:coefficient enhancing minespeed of correct block */
  dirt:{texture:"items/dirt.svg",desc:"Useless inflammable brown stuff.",place:"dirt"},
  grass:{texture:"items/grass.svg",desc:"Icky green stuff.",place:"tallgrass"},
  rock:{texture:"items/rock.svg",desc:"More abundant grey dirt.",place:"gravel"},
  wood:{texture:"items/wood.svg",desc:"Tree bones."},
  stick:{texture:"items/stick.svg",desc:"Thinner tree bones."},
  leaf:{texture:"items/leaf.svg",desc:"Tree hair."},
  pineneedle:{texture:"items/needle.svg",desc:"Thinner tree hair."},
  oaksapling:{texture:"items/oaksap.svg",desc:"Makes 1 oak tree.",place:"oaksapling"},
  pinesapling:{texture:"items/pinesap.svg",desc:"Makes 1 pine tree. Perfect for snowy places.",place:"pinesapling"},
  autumnsapling:{texture:"items/autsap.svg",desc:"Makes 1 autumn tree. Perfect for fall-themed places.",place:"autumnsapling"},
  iron:{texture:"items/feore.svg",desc:"A boring but useful metal that rusts."},
  gold:{texture:"items/auore.svg",desc:"A reddish-yellow soft metal that only looks pretty."},
  copper:{texture:"items/cuore.svg",desc:"A reddish-orange metal that patinates."},
  powerpowder:{texture:"items/poore.svg",desc:"A special material containing unused power."},
  coal:{texture:"items/coal.svg",desc:"Nonrenewable fossil fuel made of carbon."},
  sand:{texture:"items/sand.svg",desc:"Not ideal for making castles.",place:"sand"},
  rose:{texture:"rose.svg",desc:"Red semicircles.",place:"rose"},
  goldenrod:{texture:"goldenrod.svg",desc:"Yellow isosceles triangles.",place:"goldenrod"},
  myosotis:{texture:"myosotis.svg",desc:"Blue pentagons. Also known as a forget-me-not.",place:"myosotis"},
  assembler:{texture:"items/assembler.svg",ingrid:{wood:3},desc:"Making things on a table like a civilized person should do.",place:"assembler"},
  melter:{texture:"items/melter.svg",ingrid:{rock:3},desc:"Burn things in a box like a civilized person should do.",place:"melter"},
  grasspile:{texture:"items/grasspile.svg",ingrid:{grass:50},desc:"Grass smushed together.",place:"grasspile"},
  grassblock:{texture:"items/grassblock.svg",ingrid:{grasspile:50},desc:"Lots of grass smushed together.",place:"grassblock"},
  toughergrassblock:{texture:"items/toughgrass.svg",ingrid:{grassblock:50},desc:"Tons of grass smushed together.",place:"toughgrass"},
  shovel:{texture:"items/shovel.svg",ingrid:{wood:1,stick:2},desc:"A badly made wood slapper.",tool:5,toolspeed:3},
  bucket:{texture:"items/bucket.svg",metals:{iron:3},desc:"A cup made for carrying things.",tool:2,toolspeed:50},
  blade:{texture:"items/blade.svg",metals:{iron:1},desc:"A sharp flat metal stick that hurts when you eat it."},
  scissors:{texture:"items/scissors.svg",ingrid:{blade:2},desc:"Two blades put together to chop things.",tool:4,toolspeed:3},
  saw:{texture:"items/saw.svg",ingrid:{blade:1,stick:2},desc:"A stick made for destroying tree bones.",tool:3,toolspeed:15},
  water:{texture:"items/water.svg",desc:"A very delicous liquid.",place:"water"},
  lava:{texture:"items/lava.svg",desc:"A very hot liquid.",place:"lava"},
  acid:{texture:"items/acid.svg",desc:"A very dangeorous liquid.",place:"acid"},
  healingliquid:{texture:"items/healingliquid.svg",desc:"A first aid kit in a bucket.",place:"heal"},
  drill:{texture:"items/drill.svg",metals:{blade:3,powerpowder:2,iron:1},desc:"A pointy object that destroys hard stuff for you.",tool:1,toolspeed:30},
},
inv={},invMode=false,invPage="inf",
hand1="",hand2="",lel;
document.body.onkeydown=function(e){
  switch (e.keyCode) {
    case 87:wD=true;break;
    case 65:aD=true;break;
    case 83:sD=true;break;
    case 68:dD=true;break;
    case 32:spD=true;break;
    case 81:qD=true;if(!invMode)document.querySelector("#uno").style.transform="perspective(100px) rotateX(10deg)";break;
    case 69:eD=true;if(!invMode)document.querySelector("#two").style.transform="perspective(100px) rotateX(10deg)";break;
    case 80:
      if (pausd) loop=setInterval(mainloop,33);
      else clearInterval(loop);
      document.querySelector("#cover").style.cursor=pausd&&!invMode?"none":"auto";
      pausd=!pausd;
      break;
    case 51:
      document.querySelector("#cover").style.cursor=invMode?"none":"auto";
      if (invMode) {
        document.querySelector("#inv").removeChild(document.querySelector("#slotes"));
        if (invMode=='inv') document.querySelector("#inv").removeChild(document.querySelector("#info"));
        else if (invMode=='assemble') document.querySelector("#inv").removeChild(document.querySelector("#availables"));
        else if (invMode=='melt') document.querySelector("#inv").removeChild(document.querySelector("#availables"));
        document.querySelector("#inv").innerHTML=document.querySelector("#inv").innerHTML.replace(/class="hand"/g,"class='handd'").replace("one","uno");
        invMode=false;
      } else {
        heyCodeCanYouMakeTheInventoryAppearOnTheScreenForMe();
        invMode="inv";
      }
      document.querySelector("#cursor").style.display=invMode?"none":"block";
      break;
    case 50:twoD=true;break;
  }
};
document.body.onkeyup=function(e){
  switch (e.keyCode) {
    case 87:wD=false;break;
    case 65:aD=false;break;
    case 83:sD=false;break;
    case 68:dD=false;break;
    case 32:spD=false;break;
    case 81:qD=false;if(!invMode)document.querySelector("#uno").style.transform="none";break;
    case 69:eD=false;if(!invMode)document.querySelector("#two").style.transform="none";break;
    case 50:twoD=false;break;
  }
};
function init() {
  level=[];
  var heights=[Math.floor(Math.random()*30)+40];
  for (var i=0;i<lH;i++) {
    level.push([]);
    for (var j=0;j<lW;j++) {
      level[i].push("air");
      if (i==0&&j>0) heights.push(heights[heights.length-1]+Math.floor(Math.random()*5)-2);
    }
  }
  for (var i=0;i<lH;i++) {
    for (var j=0;j<lW;j++) {
      if (i==0) level[i][j]="reinforceddiamond";
      else if (i<=heights[j]-Math.floor(Math.random()*7)-2) {
        if (i<=heights[j]-20&&!Math.floor(Math.random()*400)) level[i][j]="makelava";
        else if (!Math.floor(Math.random()*100)) level[i][j]="make"+["fe","au","cu","po"][Math.floor(Math.random()*4)]+"ore";
        else if (!Math.floor(Math.random()*200)) level[i][j]="makecoal";
        else level[i][j]="stone";
      }
      else if (i<=heights[j]) {
        if (40<heights[j]) level[i][j]="dirt";
        else level[i][j]=["dirt","sand","gravel"][Math.floor(Math.random()*3)];
      }
      else if (i==heights[j]+1&&40<heights[j]) {
        if (Math.floor(Math.random()*2)) level[i][j]="tallgrass";
        else if (Math.floor(Math.random()*5)==0) level[i][j]=["oak","pine","autumn"][Math.floor(Math.random()*3)]+"sapling";
        else if (Math.floor(Math.random()*9)<8) level[i][j]=["rose","goldenrod","myosotis"][Math.floor(Math.random()*3)];
      }
      else if (40>=heights[j]&&i<=40) level[i][j]="water";
    }
  }
  function ore(size,whereX,whereY,wat) {
    level[whereY][whereX]=wat;
    for (var k=0;k<size;k++) {
      if (level[whereY+k][whereX]=="stone") level[whereY+k][whereX]=wat;
      for (var l=-Math.floor(Math.random()*size);l<Math.floor(Math.random()*size);l++) {if (level[whereY+k][whereX+l]=="stone") level[whereY+k][whereX+l]=wat;}
    }
  }
  for (var i=0;i<lH;i++) {
    for (var j=0;j<lW;j++) {
      switch (level[i][j]) {
        case "makefeore":
          ore(6,j,i,level[i][j].slice(4));
          break;
        case "makeauore":
          ore(3,j,i,level[i][j].slice(4));
          break;
        case "makecuore":
          ore(5,j,i,level[i][j].slice(4));
          break;
        case "makepoore":
          ore(4,j,i,level[i][j].slice(4));
          break;
        case "makecoal":
          ore(5,j,i,"coal");
          break;
        case "makelava":
          level[i][j]="lava";
          for (var k=0;k<4;k++) {
            if (level[i+k][j]=="stone") level[i+k][j]="lava";
            for (var l=-Math.floor(Math.random()*7);l<Math.floor(Math.random()*7);l++) {if (level[i+k][j+l]=="stone") level[i+k][j+l]="lava";}
          }
          break;
      }
    }
  }
}
init();
loop=setInterval(mainloop,33);pausd=false;
function load(page) {
  var xhttp=new XMLHttpRequest();
  xhttp.onreadystatechange=function() {
    if (this.readyState==4&&this.status==200) {
      if (page=="blockData.json") blockData=JSON.parse(this.responseText);
      else if (page=="itemData.json") itemData=JSON.parse(this.responseText);
      else console.log('So someone loaded a page but we don\' know what to do with it, so...\n'+this.responseText);
    }
  };
  xhttp.open("GET",page,true);
  xhttp.send();
}
function mainloop() {
  if (invMode) inventory();
  else {
    draw();
    interact();
    play();
    update();
  }
}
function draw() {
  sX+=Math.round((x-sX)*20)/100;
  sY+=Math.round((y-sY)*20)/100;
  if (sX<0) sX=0;
  if (sX>lW*16-480) sX=lW*16-480;
  if (sY<0) sY=0;
  if (sY>lH*16-360) sY=lH*16-360;
  function renderBlock(col,xpos,ypos,width) {
    if (ypos>360) return "";
    if (xpos>480) return "";
    return "<div class='block "+col+"' style='bottom:"+ypos+"px;left:"+xpos+"px;width:"+width+"px;'></div>";
  }
  var tempX=-sX%16,tempY=-sY%16,destX=Math.floor(sX/16)+480/16+1,destY=Math.floor(sY/16)+360/16+1,stuff="";
  for (var i=Math.floor(sY/16);i<destY;i++) {
    if (i>level.length-1) {break;}
    var t=level[i][0],c=Math.floor(sX/16);
    for (var j=c;j<destX;j++) {
      if (t!=level[i][j]) {
        if (t!="air") {
          stuff+=renderBlock(t,tempX,tempY,(j-c)*16);
        }
        tempX+=(j-c)*16;
        c=j;
        t=level[i][j];
      }
    }
    if (t!="air") {
      stuff+=renderBlock(t,tempX,tempY,(j-c)*16);
    }
    tempX+=(j-c)*16-496;
    tempY+=16;
  }
  document.querySelector("#stage").innerHTML=stuff;
  tempX=0;tempY=0;
  if (x>lW*16-480) tempX=x-(lW*16-480);
  else if (x<0) tempX=x;
  else tempX=x-sX;
  if (y>lH*16-360) tempY=y-(lH*16-360);
  else if (y<0) tempY=y;
  else tempY=y-sY;
  document.querySelector("#player").style.left=tempX+"px";
  document.querySelector("#player").style.right=-tempX+"px";
  document.querySelector("#player").style.bottom=tempY+"px";
  document.querySelector("#player").style.top=-tempY+"px";
}
function update() {
  var destX=Math.floor(sX/16)+480/16+1,destY=Math.floor(sY/16)+360/16+1;
  function getBlock(xx,yy) {
    var block;
    block=level[yy];
    if (block===undefined) return blockData["reinforceddiamond"];
    block=block[xx];
    if (block===undefined) return blockData["reinforceddiamond"];
    block=blockData[block];
    if (block===undefined) return blockData["reinforceddiamond"];
    else return block;
  }
  for (var i=Math.floor(sY/16);i<destY;i++) {
    if (i>level.length-1) {break;}
    for (var j=Math.floor(sX/16);j<destX;j++) {
      function nearTreaf(xx,yy) {
        for (var i=-5;i<=5;i++) {
          if (getBlock(xx+i,yy).grainy=="treaves") return true;
        }
        return false;
      }
      if (getBlock(j,i).grainy&&!(getBlock(j,i).grainy=="leaves"&&nearTreaf(j,i))) {
        if (level[i][j]=="grass") level[i][j]="dirt";
        if (getBlock(j,i-1).groundCover) {
          level[i-1][j]=level[i][j];
          level[i][j]="air";
        } else if (getBlock(j,i-1).liquid) {
          var tempp=level[i-1][j]
          level[i-1][j]=level[i][j];
          level[i][j]=tempp;
        }
      }
      if (getBlock(j,i).liquid) {
        var k=(Math.floor(Math.random()*2)-0.5)*2,tempp=level[i][j];
        level[i][j]="air";
        if (getBlock(j,i-1).groundCover) level[i-1][j]=tempp;
        else if (getBlock(j+1,i-1).groundCover&&getBlock(j+1,i).groundCover) level[i-1][j+1]=tempp;
        else if (getBlock(j-1,i-1).groundCover&&getBlock(j-1,i).groundCover) level[i-1][j-1]=tempp;
        else if (getBlock(j+k,i).groundCover) level[i][j+k]=tempp;
        else level[i][j]=tempp;
      }
      if (getBlock(j,i).furn||getBlock(j,i).groundCover&&level[i][j]!="air") {
        if (getBlock(j,i-1).trnsp) {
          addToInv(level[i][j]);
          level[i][j]="air";
        }
      }
      switch (level[i][j]) {
        case "dirt":
          if (getBlock(j,i+1).trnsp) level[i][j]="grass";
          break;
        case "grass":
          if (!getBlock(j,i+1).trnsp) level[i][j]="dirt";
          break;
        case "oaksapling":
          var hite=Math.floor(Math.random()*5)+5;
          for (var k=0;k<hite;k++) {
            if (k<hite/3) level[i+k][j]="oaktrunk";
            else {
              level[i+k][j]="oaktreaves";
              for (var l=1;l<Math.floor(Math.random()*2)+(hite/2-Math.abs(k-(hite/2+1)));l++) level[i+k][j+l]="oakleaves";
              for (var l=1;l<Math.floor(Math.random()*2)+(hite/2-Math.abs(k-(hite/2+1)));l++) level[i+k][j-l]="oakleaves";
            }
          }
          level[i+hite][j]="oakleaves";
          break;
        case "pinesapling":
          var hite=Math.floor(Math.random()*5)+7;
          for (var k=0;k<hite;k++) {
            if (k<hite/3) level[i+k][j]="pinetrunk";
            else {
              level[i+k][j]="pinetreaves";
              for (var l=1;l<(hite-k)/(Math.random()*2+1.5);l++) level[i+k][j+l]="pineleaves";
              for (var l=1;l<(hite-k)/(Math.random()*2+1.5);l++) level[i+k][j-l]="pineleaves";
            }
          }
          level[i+hite][j]="pineleaves";
          break;
        case "autumnsapling":
          var hite=Math.floor(Math.random()*5)+5;
          for (var k=0;k<hite;k++) {
            if (k<hite/3) level[i+k][j]="auttrunk";
            else {
              level[i+k][j]="aut"+Math.floor(Math.random()*3+1)+"treaves";
              for (var l=1;l<Math.floor(Math.random()*2)+(hite/2-Math.abs(k-(hite/2+1)));l++) level[i+k][j+l]="aut"+Math.floor(Math.random()*3+1)+"leaves";
              for (var l=1;l<Math.floor(Math.random()*2)+(hite/2-Math.abs(k-(hite/2+1)));l++) level[i+k][j-l]="aut"+Math.floor(Math.random()*3+1)+"leaves";
            }
          }
          level[i+hite][j]="aut"+Math.floor(Math.random()*3+1)+"leaves";
          break;
        case "lava":
          for (var k=1;k<9;k+=2) {
            if (level[k%3-1+i][Math.floor(k/3)-1+j]=="water") {
              level[k%3-1+i][Math.floor(k/3)-1+j]="vapour";
              level[i][j]="stone";
              break;
            }
            if (getBlock(Math.floor(k/3)-1+j,k%3-1+i).trnsp&&!Math.floor(Math.random()*200)) {
              level[i][j]="stone";
              break;
            }
          }
          break;
        case "vapour":
          if (!Math.floor(Math.random()*200)) level[i][j]="water";
          else if (!Math.floor(Math.random()*3)&&i<150) {
            var k=Math.floor(Math.random()*3)-1;
            level[i][j]="air";
            if (getBlock(j+k,i+1).groundCover) level[i+1][j+k]="vapour";
            else if (getBlock(j+k,i+1).liquid) {level[i][j]=level[i+1][j+k];level[i+1][j+k]="vapour";}
            else if (getBlock(j+k,i).groundCover) level[i][j+k]="vapour";
            else if (getBlock(j+k,i).liquid) {level[i][j]=level[i][j+k];level[i][j+k]="vapour";}
            else level[i][j]="vapour";
          }
          break;
        case "water":
          for (var k=1;k<9;k+=2) {
            if (getBlock(Math.floor(k/3)-1+j,k%3-1+i).trnsp&&!Math.floor(Math.random()*200)) {
              level[i][j]="vapour";
              break;
            }
          }
          break;
        case "acid":
          if (level[i+1][j]=="stone"&&!Math.floor(Math.random()*10)) level[i+1][j]="acidproof";
          if (!getBlock(j,i-1).acidproof&&!Math.floor(Math.random()*10)) level[i-1][j]=level[i-1][j]=="stone"&&!Math.floor(Math.random()*10)?"acidproof":"acidvapour";
          if (!getBlock(j-1,i).acidproof&&!Math.floor(Math.random()*3)) level[i][j-1]=level[i][j-1]=="stone"&&!Math.floor(Math.random()*10)?"acidproof":"acidvapour";
          if (!getBlock(j+1,i).acidproof&&!Math.floor(Math.random()*3)) level[i][j+1]=level[i][j+1]=="stone"&&!Math.floor(Math.random()*10)?"acidproof":"acidvapour";
          break;
        case "acidvapour":
          if (!Math.floor(Math.random()*200)) level[i][j]="air";
          else if (!Math.floor(Math.random()*3)&&i<150) {
            var k=Math.floor(Math.random()*3)-1;
            level[i][j]="air";
            if (getBlock(j+k,i+1).groundCover) level[i+1][j+k]="acidvapour";
            else if (getBlock(j+k,i+1).liquid) {level[i][j]=level[i+1][j+k];level[i+1][j+k]="acidvapour";}
            else if (getBlock(j+k,i).groundCover) level[i][j+k]="acidvapour";
            else if (getBlock(j+k,i).liquid) {level[i][j]=level[i][j+k];level[i][j+k]="acidvapour";}
            else level[i][j]="acidvapour";
          }
          break;
      }
    }
  }
}
function foo(xo,yo) { // in px
  return level[Math.floor((y+180+yo)/16)][Math.floor((x+240+xo)/16)];
}
function play() {
  x+=xv;y+=yv;
  function collideable(xOff,yOff) { // in px
    var leX=Math.floor((x+240+xOff)/16),leY=Math.floor((y+180+yOff)/16),block=level[leY][leX];
    if (block===undefined)
      return true;
    else {
      if (blockData[block].liquid) return false;
      else return !(blockData[block].trnsp);
    }
  }
  var colLWall=collideable(-8,0)||collideable(-8,-15),
  colRWall=collideable(7,0)||collideable(7,-15),
  collidingWithWall=colLWall||colRWall;
  water=false,
  ceilingAbove=collideable(6,16)||collideable(-7,16);
  if (colLWall&&colRWall) collidingWithWall=false;
  if (collideable(6,-16)||collideable(-7,-16)) {
    yv=0;
    var backupY=y;
    y=Math.ceil((y-12)/16)*16+12;
    if (collidingWithWall) {
      colLWall=collideable(-8,0)||collideable(-8,-15);
      colRWall=collideable(7,0)||collideable(7,-15);
      collidingWithWall=colLWall||colRWall;
      if (collidingWithWall&&!collideable(0,-16)) y=backupY;
    }
  }
  if (
    blockData[level[Math.floor((y+172)/16)][Math.floor((x+172)/16)]].liquid||
    blockData[level[Math.floor((y+172)/16)][Math.floor((x+248)/16)]].liquid||
    blockData[level[Math.floor((y+188)/16)][Math.floor((x+172)/16)]].liquid||
    blockData[level[Math.floor((y+188)/16)][Math.floor((x+248)/16)]].liquid||
    blockData[level[Math.floor((y+204)/16)][Math.floor((x+172)/16)]].liquid||
    blockData[level[Math.floor((y+204)/16)][Math.floor((x+248)/16)]].liquid
  ) { /* swimming */
    water=true;
    if (spD) {
      xv=Math.round(xv*800)/1000;
      yv=Math.round(yv*800)/1000;
    } else {
      xv=Math.round(xv*950)/1000;
      yv=Math.round(yv*950)/1000;
      if(wD&&yv<7)yv+=1;
      if(aD&&xv>-7)xv-=1;
      if(sD&&yv>-7)yv-=1;
      if(dD&&xv<7)xv+=1;
    }
  } else if (!(collideable(-7,-17)||collideable(6,-17))) {
    if (yv>-20) yv--;
    var touchingLeftWall=collideable(-9,15)||collideable(-9,-16),touchingRightWall=collideable(8,15)||collideable(8,-16);
    if (aD&&!dD&&xv>-7&&!touchingLeftWall&&touchingRightWall) xv-=2;
    else if (dD&&!aD&&xv<7&&!touchingRightWall&&touchingLeftWall) xv+=2;
  }
  else { /* MOVING */
    if (wD&&!ceilingAbove&&!collidingWithWall) yv=7;
    if (spD&&(collideable(-7,-17)||collideable(6,-17))) xv=Math.round(xv*300)/1000;
    else if (aD&&!dD&&xv>-7&&!(collideable(-9,15)||collideable(-9,-16))) xv-=1;
    else if (dD&&!aD&&xv<7&&!(collideable(8,15)||collideable(8,-16))) xv+=1;
    else if (!aD&&!dD) xv=Math.round(xv*700)/1000;
    if (Math.abs(xv)<0.01) {
      xv=0;
      x=Math.round(x*1000)/1000;
    }
  }
  if (collideable(6,15)||collideable(-7,15)) {
    if (!water&&!collidingWithWall) yv=-1;
    var backupY=y;
    y=Math.floor((y-12)/16)*16+12;
    if (collidingWithWall) {
      colLWall=collideable(-8,0)||collideable(-8,-15);
      colRWall=collideable(7,0)||collideable(7,-15);
      collidingWithWall=colLWall||colRWall;
      if (collidingWithWall&&!collideable(0,-16)) {
        y=backupY;
        ceilingAbove=false;
      }
    }
  }
  if (collidingWithWall) {
    if (colLWall) x=Math.ceil((x+8)/16)*16-8;
    else if (colRWall) x=Math.floor((x-8)/16)*16+8;
    else alert("wat");
    var isNotBetweenWalls=colLWall&&!(collideable(8,0)||collideable(8,-15))||colRWall&&!(collideable(-9,0)||collideable(-9,-15));
    /*if ((aD||dD)&&Math.abs(xv*100)>1&&isNotBetweenWalls) {
      if (wD&&!water&&!ceilingAbove) {
        yv+=3;
        //xv*=-1;
      }
      //else xv*=-0.5;
    }
    else*/ xv=0;
  }
  if (x<-232) x=-232;
  if (y<-172) y=-172;
  if (x>lW*16-240) x=lW*16-240;
  if (y>lH*16-180) y=lH*16-180;
}
function addToInv(blockName) {
  var items=blockData[blockName].drops;
  for (var item in items) {
    var count=items[item];
    if (typeof count=="string") {
      var min=Number(count.slice(0,count.indexOf("-"))),max=Number(count.slice(count.indexOf("-")+1));
      count=Math.floor(Math.random()*(max-min+1))+min;
      if (count===0) break;
    }
    if (!inv.hasOwnProperty(item)) inv[item]=0;
    inv[item]+=count;
    if (!hand1&&hand2!=item&&!qD) hand1=item;
    else if (!hand2&&hand1!=item&&!eD) hand2=item;
  }
  if (items.hasOwnProperty(hand1)||items.hasOwnProperty(hand2)) renderHands();
}
function interact() {
  var selX,selY,styX,styY;
  if (sX>lW*16-480) {
    styX=Math.round((mX+(lW*16-480)%16-8)/16)*16-(lW*16-480)%16+8;
    selX=Math.floor((lW*16-240+mX)/16);
  } else if (sX<0) {
    styX=Math.round((mX-8)/16)*16+8;
    selX=Math.floor((240+mX)/16);
  } else {
    styX=Math.round((mX+sX%16-8)/16)*16-sX%16+8;
    selX=Math.floor((sX+240+mX)/16);
  }
  if (sY>lH*16-360) {
    styY=Math.round((mY+(lH*16-360)%16-4)/16)*16-(lH*16-360)%16+8;
    selY=Math.floor((lH*16-180+mY)/16);
  } else if (sY<0) {
    styY=Math.round((mY-4)/16)*16+4;
    selY=Math.floor((180+mY)/16);
  } else {
    styY=Math.round((mY+sY%16-4)/16)*16-sY%16+4;
    selY=Math.floor((sY+180+mY)/16);
  }
  if (mineInfo.length>0) {
    if (qD||eD) {
      if (selX!=mineInfo[3]||selY!=mineInfo[4]) mineInfo=[];
      else if (Date.now()>=mineInfo[1]+mineInfo[2]) {
        addToInv(level[mineInfo[4]][mineInfo[3]]);
        if (mineInfo[0].slice(-7)=="treaves"&&mineInfo[0].slice(0,3)=="aut") level[mineInfo[4]][mineInfo[3]]="auttrunk";
        else if (mineInfo[0].slice(-7)=="treaves") level[mineInfo[4]][mineInfo[3]]=mineInfo[0].slice(0,-7)+"trunk";
        else level[mineInfo[4]][mineInfo[3]]="air";
        mineInfo=[];
      }
      else document.querySelector("#cursor").style.background="rgba(0, 0, 0,"+((Date.now()-mineInfo[2])/mineInfo[1])+")";
    }
    else mineInfo=[];
  } else {
    var item;
    if (qD) item=hand1;
    else if (eD) item=hand2;
    if (item&&itemData[item].place) {
      if (blockData[level[selY][selX]].furn) {
        if (level[selY][selX]=="assembler") {
          document.querySelector("#cover").style.cursor="auto";
          document.querySelector("#cursor").style.display="none";
          invMode="assemble";
          plsMakeCraftingUIAppearForMe();
        } else if (level[selY][selX]=="melter") {
          document.querySelector("#cover").style.cursor="auto";
          document.querySelector("#cursor").style.display="none";
          invMode="melt";
          plsMakeCraftingUIAppearForMe();
        }
      } else if (blockData[level[selY][selX]].groundCover) {
        if (level[selY][selX]!="air") addToInv(level[selY][selX]);
        level[selY][selX]=itemData[item].place;
        inv[item]--;
        if (!inv[item]) {
          delete inv[item];
          if (item==hand1) hand1='';
          else hand2='';
        }
        renderHands();
      } else if (qD||eD) {
        var time=blockData[level[selY][selX]].mineTime,speed=1;
        if (time!=-1) {
          if (item&&itemData[item].tool&&itemData[item].tool==blockData[level[selY][selX]].tool) speed=itemData[item].toolspeed;
          mineInfo=[level[selY][selX],time*1000/speed,Date.now(),selX,selY];
        }
      }
    } else if (qD||eD) {
      var time=blockData[level[selY][selX]].mineTime,speed=1;
      if (time!=-1) {
        if (item&&itemData[item].tool&&itemData[item].tool==blockData[level[selY][selX]].tool) speed=itemData[item].toolspeed;
        mineInfo=[level[selY][selX],time*1000/speed,Date.now(),selX,selY];
      }
    }
    if (document.querySelector("#cursor").style.background!="none") document.querySelector("#cursor").style.background="none";
  }
  document.querySelector("#cursor").style.left=styX+"px";
  document.querySelector("#cursor").style.right=-styX+"px";
  document.querySelector("#cursor").style.bottom=styY+"px";
  document.querySelector("#cursor").style.top=-styY+"px";
}
function prepareInventoryMagicness(extras) {
  var extras;
  if (!extras) extras='';
  var items=[];
  for (var item in inv) items.push(item);
  var leShtoof='<ul id="slotes">';
  for (var i=0;i<8;i++) {
    for (var j=0;j<5;j++) {
      var n="",b="";
      if (i*5+j<items.length) {
        n=inv[items[i*5+j]];
        b="background-image:url('"+itemData[items[i*5+j]].texture+"');";
      }
      leShtoof+='<li style="'+(j===0?"clear:both;":"")+b+'" class="invSlot">'+n+'</li>';
    }
  }
  leShtoof+="</ul>"+extras+"<div class='hand' id='one'></div><div class='hand' id='two'></div>";
  document.querySelector("#inv").innerHTML=leShtoof;
  if (hand1) {
    document.querySelector("#one").style.backgroundImage="url("+itemData[hand1].texture+")";
    document.querySelector("#one").innerHTML=inv[hand1];
  }
  if (hand2) {
    document.querySelector("#two").style.backgroundImage="url("+itemData[hand2].texture+")";
    document.querySelector("#two").innerHTML=inv[hand2];
  }
  var lol=function(e){
    var temp;
    if (e.keyCode==81) {
      hand1=lel;
      temp=document.querySelector('#one');
    } else if (e.keyCode==69) {
      hand2=lel;
      temp=document.querySelector('#two');
    } else if (e.keyCode==51) {
      document.body.removeEventListener("keydown",lol);;
    }
    if (temp!==undefined) {
      if (lel==='') {
        temp.style.backgroundImage="none";
        temp.innerHTML='';
      } else {
        temp.style.backgroundImage="url("+itemData[lel].texture+")";
        temp.innerHTML=inv[lel];
      }
    }
  }
  document.querySelector("#slotes").onmouseover=function(e){
    if (e.target.tagName=="LI") {
      var back=e.target.style.backgroundImage,name='',inner='';
      if (back!=='') {
        back=back.slice(back.indexOf('"')+1,back.lastIndexOf('"'));
        for (name in itemData) {
          if (itemData[name].texture==back) break;
        }
      }
      lel=name;
      document.body.addEventListener("keydown",lol);
      if (invMode=="inv") {
        if (e.target.innerHTML&&invPage=="inf") {
          inner+="<h1>"+name+"</h1><br>"+itemData[name].desc;
          document.querySelector('#content').style.backgroundImage="url("+back+")";
          document.querySelector('#content').innerHTML=inner;
        }
      }
    }
  };
  document.querySelector("#slotes").onmouseout=function(e){
    if (invMode=="inv") {
      if (document.querySelector('#content').innerHTML&&invPage=="inf") {
        document.querySelector('#content').innerHTML="";
        document.querySelector('#content').style.backgroundImage="none";
      }
    }
    document.body.removeEventListener("keydown",lol);
  };
}
function plsMakeCraftingUIAppearForMe() {
  if (invMode=='assemble') prepareInventoryMagicness("<ul id='availables'></ul>");
  else if (invMode=='melt') prepareInventoryMagicness("<ul id='availables'></ul>");
  else prepareInventoryMagicness();
  document.querySelector("#availables").onclick=function(e){
    if (e.target.tagName!="UL"&&e.target.className!='invname') {
      if (e.target.tagName=="LI") var item=e.target.querySelector('h1').innerHTML;
      else if (e.target.tagName=="H1") var item=e.target.innerHTML;
      function removeFromInv(item,count) {
        inv[item]-=count;
        if (!inv[item]) {
          delete inv[item];
          if (item==hand1) hand1='';
          else if (item==hand2) hand2='';
        }
      }
      if (invMode=='assemble') {
        for (var ingridient in itemData[item].ingrid) removeFromInv(ingridient,itemData[item].ingrid[ingridient]);
      }
      if (invMode=='melt') {
        removeFromInv('coal',1);
        for (var ingridient in itemData[item].metals) removeFromInv(ingridient,itemData[item].metals[ingridient]);
      }
      if (!inv.hasOwnProperty(item)) inv[item]=1;
      else inv[item]++;
      if (!hand1&&hand2!=item) hand1=item;
      else if (!hand2&&hand1!=item) hand2=item;
      plsMakeCraftingUIAppearForMe();
    }
  };
}
function heyCodeCanYouMakeTheInventoryAppearOnTheScreenForMe() {
  prepareInventoryMagicness("<div id='info'><ul id='tabs'><li id='inf'></li><li id='craft'></li><li id='clothes'></li><li id='menu'></li></ul><div id='content'></div></div>");
  document.querySelector("#"+invPage).className="active";
  document.querySelector("#tabs").onclick=function(e){
    if (e.target.tagName=="LI") invPage=e.target.id;
    document.querySelector(".active").className="";
    document.querySelector("#"+invPage).className="active";
    document.querySelector("#content").innerHTML="";
  };
  document.querySelector("#content").onclick=function(e){
    if (invPage=="craft") {
      if (inv.wood>=3) {
        inv.wood-=3;
        if (!inv.wood) {
          delete inv.wood;
          if ("wood"==hand1) hand1='';
          else if ("wood"==hand2) hand2='';
        }
        if (!inv.hasOwnProperty("assembler")) inv.assembler=1;
        else inv.assembler++;
        if (!hand1&&hand2!='assembler') hand1='assembler';
        else if (!hand2&&hand1!='assembler') hand2='assembler';
        heyCodeCanYouMakeTheInventoryAppearOnTheScreenForMe();
      }
    }
  };
  /*
  inv[item]--;
  if (!inv[item]) {
    delete inv[item];
    if (item==hand1) hand1='';
    else hand2='';
  }
  */
}
function inventory() {
  if (invMode=="inv") {
    if (invPage=="craft"&&!document.querySelector("#content").innerHTML) {
      if (inv.wood>=3) {
        document.querySelector("#content").innerHTML="<h1>assembler</h1><br>"+itemData.assembler.desc;
        document.querySelector('#content').style.backgroundImage="url("+itemData.assembler.texture+")";
      }
    }
  }
  if (invMode=="assemble") {
    var tempList='<h1 class="invname">Assembler</h1>';
    for (var item in itemData) {
      if (itemData[item].ingrid) {
        var ingridients=itemData[item].ingrid,allGood=true;
        for (var ingridient in ingridients) {
          if (!(inv[ingridient]>=ingridients[ingridient])) {
            allGood=false;
            break;
          }
        }
        if (allGood) tempList+='<li style="background-image:url(\''+itemData[item].texture+'\');"><h1>'+item+'</h1><br>'+itemData[item].desc+'</li>';
      }
    }
    if (tempList!=document.querySelector("#availables").innerHTML) document.querySelector("#availables").innerHTML=tempList;
  }
  if (invMode=="melt") {
    var tempList='<h1 class="invname">Melter</h1><p class="invname">Uses 1 coal for every melting.</p>';
    for (var item in itemData) {
      if (itemData[item].metals) {
        var ingridients=itemData[item].metals,allGood=true;
        if (!inv.coal) {
          allGood=false;
        } else {
          for (var ingridient in ingridients) {
            if (!(inv[ingridient]>=ingridients[ingridient])) {
              allGood=false;
              break;
            }
          }
        }
        if (allGood) tempList+='<li style="background-image:url(\''+itemData[item].texture+'\');"><h1>'+item+'</h1><br>'+itemData[item].desc+'</li>';
      }
    }
    if (tempList!=document.querySelector("#availables").innerHTML) document.querySelector("#availables").innerHTML=tempList;
  }
}
function renderHands() {
  if (hand1) {
    document.querySelector("#uno").style.backgroundImage="url("+itemData[hand1].texture+")";
    document.querySelector("#uno").innerHTML=inv[hand1];
  } else {
    document.querySelector("#uno").style.backgroundImage="none";
    document.querySelector("#uno").innerHTML='';
  }
  if (hand2) {
    document.querySelector("#two").style.backgroundImage="url("+itemData[hand2].texture+")";
    document.querySelector("#two").innerHTML=inv[hand2];
  } else {
    document.querySelector("#two").style.backgroundImage="none";
    document.querySelector("#two").innerHTML='';
  }
}
document.onmousemove=function(e){
  mX=e.clientX-window.innerWidth/2;
  mY=-e.clientY+window.innerHeight/2;
  if (Math.abs(mX)>240) mX=mX/Math.abs(mX)*240;
  if (Math.abs(mY)>180) mY=mY/Math.abs(mY)*180;
}
function test(what) {
  var what;
  if (what) console.log(what);
  clearInterval(loop);
  pausd=true;
  thisFunctionIsForDebuggingLol;
}
    </script>
<!-- MADE BY SEAN -->
  </body>
</html>
