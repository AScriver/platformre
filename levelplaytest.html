<!DOCTYPE html>
<html>
  <head>
    <title>Platformre level test</title>
    <meta charset="UTF-8">
    <style>
#player {
  position: absolute;
  background: #E91E63;
  height: 30px;
  width: 30px;
  border-radius: 50%;
  bottom: 0;
  left: 0;
}
.level {
  margin: auto;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
}
.levelRow {
  height: 40px;
}
.levelBlock {
  height: 40px;
  width: 40px;
  display: inline-block;
}
.air {
  background: none;
}
.ground {
  background: #212121;
}
.lava {
  background: #FF5722;
}
.win {
  background: #8BC34A;
}
    </style>
  </head>
  <body>
    <p><b>Use the keys WAD to move the player around.</b></p>
    <p>w pressed: <span id="w">no</span></p>
    <p>a pressed: <span id="a">no</span></p>
    <p>d pressed: <span id="d">no</span></p>
    <p id="vels"></p>
    <div class="level">
      <div id="player"></div>
    </div>
    
    <script src="../sheep.js"></script>
    <script>
var levels=[ /* space=air, @=ground, #=lava */
  [
  "@@@@@@@@@@@@@@@@",
  "@          @@@@@",
  "@              @",
  "@   @@@@@      @",
  "@     #        +",
  "@     #    @ @+@",
  "@@@@@###@@@@@@@@",
  ],[
  "@@@", /* emergency last level */
  "@ @",
  "@@@",
  ],
];
function render(level) {
  var data="<div id='player'></div>";
  for (var i=0;i<levels[level].length;i++) {
    data+="<div class='levelRow'>";
    for (var j=0;j<levels[level][i].length;j++) {
      switch (levels[level][i][j]) {
        case " ":
          data+="<div class='levelBlock air'></div>";
          break;
        case "@":
          data+="<div class='levelBlock ground'></div>";
          break;
        case "#":
          data+="<div class='levelBlock lava'></div>";
          break;
        case "+":
          data+="<div class='levelBlock win'></div>";
          break;
      }
    }
    data+="</div>";
  }
  document.querySelector(".level").innerHTML=data;
  document.querySelector(".level").style.width=(levels[level][0].length*40)+"px";
  document.querySelector(".level").style.height=(levels[level].length*40)+"px";
}
var wDown=false,aDown=false,dDown=false;
document.body.onkeydown=function(e){
  var ele;
  switch (e.keyCode) {
    case 87:
      ele="w";
      wDown=true;
      break;
    case 65:
      ele="a";
      aDown=true;
      break;
    case 68:
      ele="d";
      dDown=true;
      break;
    case 82:
      die();
      break;
  }
  if (ele!==undefined) {
    document.querySelector("#"+ele).innerHTML="yes";
  }
};
document.body.onkeyup=function(e){
  var ele;
  switch (e.keyCode) {
    case 87:
      ele="w";
      wDown=false;
      break;
    case 65:
      ele="a";
      aDown=false;
      break;
    case 68:
      ele="d";
      dDown=false;
      break;
  }
  if (ele!==undefined) {
    document.querySelector("#"+ele).innerHTML="no";
  }
};
/* plattformre script based off those from Scratch */
var xv=0,yv=0,x=40,y=40,lev=0,play=function(){
  if (getBlock(0,-16)==" ") { /* ground and gravity and moving */
    yv-=1;
  } else if (getBlock(0,-16)=="#") {
    die();
  } else if (getBlock(0,-16)=="+") {
    die();lev++;render(lev);
  } else {
    yv=0;
    y=Math.round((y-5)/40)*40;
    xv=Math.round(xv*800)/1000;
    if (Math.abs(xv)<0.01) {
      xv=0;
      x=Math.round(x*1000)/1000;
    }
    if (wDown) {
      yv=15;
    }
    if (aDown) {
      xv-=1.5;
    }
    if (dDown) {
      xv+=1.5;
    }
  }
  if (getBlock(0,15)=="#") { /* ceiling */
    die();
  } else if (getBlock(0,15)=="+") {
    die();lev++;render(lev);
  } else if (getBlock(0,15)!=" ") {
    yv=0;
    y=Math.round((y-5)/40)*40+9;
  }
  if (getBlock(-16,0)=="#") { /* left wall */
    die();
  } else if (getBlock(-16,0)=="+") {
    die();lev++;render(lev);
  } else if (getBlock(-16,0)!=" ") {
    if (aDown||dDown) {
      if (wDown) {
        yv=10;
        xv*=-1;
      } else {
        xv*=-0.5;
        yv=0;
      }
    } else {
      xv*=-0.1;
      yv=0;
    }
    x=Math.round((x-5)/40)*40+1;
  }
  if (getBlock(15,0)=="#") { /* right wall */
    die();
  } else if (getBlock(15,0)=="+") {
    die();lev++;render(lev);
  } else if (getBlock(15,0)!=" ") {
    if (aDown||dDown) {
      if (wDown) {
        yv=10;
        xv*=-1;
      } else {
        xv*=-0.5;
        yv=0;
      }
    } else {
      xv*=-0.1;
      yv=0;
    }
    x=Math.round((x-5)/40)*40+10;
  }
  if (getBlock(0,0)=="@") { /* pop out of a block */
    y+=40;
  }
  x+=xv;y+=yv;
  document.querySelector("#vels").innerHTML="{<br>xVelocity: "+xv+",<br>vVelocity:"+yv+",<br>xPosition:"+x+",<br>yPosition:"+y+"<br>}";
  document.querySelector("#player").style.left=x+"px";
  document.querySelector("#player").style.bottom=y+"px";
};
render(lev);
var wow=setInterval(play,33);
function getBlock(nx,ny) {
  nx=Math.round((x+nx-5)/40);ny=Math.round((y+ny-5)/40);
  return levels[lev][levels[lev].length-1-ny][nx];
}
function foo(ox,oy) {
  console.log(Math.round((x+ox-5)/40));
  console.log(Math.round((y+oy-5)/40));
  console.log(getBlock(ox,oy));
}
function die() {
  xv=0,yv=0,x=40,y=40;
}
    </script>
  </body>
</html>
